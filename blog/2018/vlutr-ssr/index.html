<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> 在Vultr上搭建SSR服务 | Curiousity Hub </title> <meta name="author" content="Zenan Huang"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="causal-learning, causal-discovery, transfer-learning, LLMs, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon-32x32-next-my.png?b29ea1d332f6bc3c021e15d78d266303"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://lccurious.github.io/blog/2018/vlutr-ssr/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Curiousity Hub </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/cv/">cv</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">在Vultr上搭建SSR服务</h1> <p class="post-meta"> March 03, 2018 </p> <p class="post-tags"> <a href="/blog/2018"> <i class="fa-solid fa-calendar fa-sm"></i> 2018 </a>   ·   <a href="/blog/tag/ssr"> <i class="fa-solid fa-hashtag fa-sm"></i> SSR</a>   <a href="/blog/tag/vultr"> <i class="fa-solid fa-hashtag fa-sm"></i> Vultr</a>     ·   <a href="/blog/category/%E5%B7%A5%E7%A8%8B"> <i class="fa-solid fa-tag fa-sm"></i> 工程</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>用过很多第三方提供的梯子，因为是多人使用的，总是出现这样或那样的问题，使人非常困扰。还是自己动手搭建一个看看效果如何。</p> <h2 id="原理">原理</h2> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2018-03-03-vlutr-ssr/SSR_protocol-480.webp 480w,/assets/img/2018-03-03-vlutr-ssr/SSR_protocol-800.webp 800w,/assets/img/2018-03-03-vlutr-ssr/SSR_protocol-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/2018-03-03-vlutr-ssr/SSR_protocol.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="SSR_protocol" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="购买">购买</h2> <p>可以使用我提供的<a href="https://www.vultr.com/?ref=7346922/" rel="external nofollow noopener" target="_blank">推荐链接</a>注册，新用户激活后一个月内有付费行为就可以获赠 $20。</p> <p>我习惯性选择CentOS，这个系统比较适合作为网络服务器，相较于其他系统CentOS可以提供更为高速的网络连接。如果是个人上网的话选择5刀一个月的版本就很足够了。</p> <h3 id="部署vps">部署VPS</h3> <p>选好服务器之后，其他配置都可以直接使用默认。其中SSH Keys的作用是可以让你登陆的时候不用总是输密码。</p> <p>等待系统自己部署完成之后你就可以查看自己的服务器信息了，还可以进行其他操作。</p> <h3 id="连接vps">连接VPS</h3> <p>一般Ubuntu和Mac系统都可以直接使用ssh进入服务器的控制，Win10的话可以直接使用powershell使用ssh或者安装一个软件名字为Putty。</p> <p>然后使用Vultr提供的root用户名和密码，登入自己服务器就可以了。但是在这种密码登陆的情况下总是会受到其他服务器的扫描并且会被尝试暴力登陆，所以建议服务器用密钥登陆，并且禁止使用密码登陆。</p> <p>首先将我们需要用于远程连接VPS的公钥加入服务器的 <code class="language-plaintext highlighter-rouge">.ssh/authorized_keys</code> 文件中去，然后修改 <code class="language-plaintext highlighter-rouge">/etc/ssh/sshd_config</code> 文件</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PasswordAutentication no
AuthorizedKeysFile .ssh/authorized_keys
</code></pre></div></div> <p>之后再重启sshd服务</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>service sshd restart
</code></pre></div></div> <h2 id="部署ssr">部署SSR</h2> <h3 id="安装">安装</h3> <p>shadowsocks的部署分客户端和服务器端，我们通过ssh在远程服务器上部署服务端。方便起见使用<a href="https://teddysun.com/342.html" rel="external nofollow noopener" target="_blank">teddysun</a>提供的一键部署方案。</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget <span class="nt">--no-check-certificate</span> https://raw.githubusercontent.com/teddysun/shadowsocks_install/master/shadowsocks.sh
<span class="nb">chmod</span> +x shadowsocks.sh
./shadowsocks.sh 2&gt;&amp;1 | <span class="nb">tee </span>shadowsocks.log
</code></pre></div></div> <p>最后一步输完，你应该会看到下图中内容──是要你为 Shadowsocks 服务设置一个个人密码。这个密码是使用这个代理服务器所用的密码，然后按照你个人设定一步步配置下来，通常默认的配置都没什么问题。</p> <p><strong>默认配置：</strong> 服务器端口：自己设定（如不设定，默认从 9000-19999 之间随机生成） 密码：自己设定（如不设定，默认为 teddysun.com） 加密方式：自己设定（如不设定，默认为 aes-256-cfb） 协议（Protocol）：自己设定（如不设定，默认为 origin） 混淆（obfs）：自己设定（如不设定，默认为 plain）</p> <p>安装完成后你会看到以下格式的信息输出：</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Congratulations, ShadowsocksR server <span class="nb">install </span>completed!
Your Server IP        :your_server_ip
Your Server Port      :your_server_port
Your Password         :your_password
Your Protocol         :your_protocol
Your obfs             :your_obfs
Your Encryption Method:your_encryption_method

Welcome to visit:https://shadowsocks.be/9.html
Enjoy it!
</code></pre></div></div> <p>这就是你在本地客户端所要配置的内容了。</p> <h3 id="卸载方法">卸载方法</h3> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./shadowsocksR.sh uninstall
</code></pre></div></div> <h3 id="使用命令">使用命令</h3> <p>启动：<code class="language-plaintext highlighter-rouge">/etc/init.d/shadowsocks start</code> 停止：<code class="language-plaintext highlighter-rouge">/etc/init.d/shadowsocks stop</code> 重启：<code class="language-plaintext highlighter-rouge">/etc/init.d/shadowsocks restart</code> 状态：<code class="language-plaintext highlighter-rouge">/etc/init.d/shadowsocks status</code></p> <p>配置文件路径：/etc/shadowsocks.json 日志文件路径：/var/log/shadowsocks.log 代码安装目录：/usr/local/shadowsocks</p> <h3 id="多用户配置示例">多用户配置示例</h3> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span>
<span class="s2">"server"</span>:<span class="s2">"0.0.0.0"</span>,
<span class="s2">"server_ipv6"</span>: <span class="s2">"[::]"</span>,
<span class="s2">"local_address"</span>:<span class="s2">"127.0.0.1"</span>,
<span class="s2">"local_port"</span>:1080,
<span class="s2">"port_password"</span>:<span class="o">{</span>
    <span class="s2">"8989"</span>:<span class="s2">"password1"</span>,
    <span class="s2">"8990"</span>:<span class="s2">"password2"</span>,
    <span class="s2">"8991"</span>:<span class="s2">"password3"</span>
<span class="o">}</span>,
<span class="s2">"timeout"</span>:300,
<span class="s2">"method"</span>:<span class="s2">"aes-256-cfb"</span>,
<span class="s2">"protocol"</span>: <span class="s2">"origin"</span>,
<span class="s2">"protocol_param"</span>: <span class="s2">""</span>,
<span class="s2">"obfs"</span>: <span class="s2">"plain"</span>,
<span class="s2">"obfs_param"</span>: <span class="s2">""</span>,
<span class="s2">"redirect"</span>: <span class="s2">""</span>,
<span class="s2">"dns_ipv6"</span>: <span class="nb">false</span>,
<span class="s2">"fast_open"</span>: <span class="nb">false</span>,
<span class="s2">"workers"</span>: 1
<span class="o">}</span>
</code></pre></div></div> <h3 id="设置防火墙">设置防火墙</h3> <p>Vultr控制台防火墙有时不好使，还是原生配置吧</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>firewall-cmd <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--add-port</span><span class="o">=</span>80/tcp <span class="nt">--permanent</span> <span class="c"># 开80端口</span>
firewall-cmd <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--add-port</span><span class="o">=</span>1433/tcp <span class="nt">--permanent</span> <span class="c"># 开23333 TCP端口</span>
firewall-cmd <span class="nt">--zone</span><span class="o">=</span>public <span class="nt">--add-port</span><span class="o">=</span>1433/udp <span class="nt">--permanent</span> <span class="c"># 开23333 UDP端口</span>
firewall-cmd <span class="nt">--reload</span>  <span class="c"># 重载配置</span>
iptables <span class="nt">-L</span> <span class="nt">-n</span>  <span class="c"># 查询防火墙规则</span>
</code></pre></div></div> <h3 id="服务加速">服务加速</h3> <p>首先是打开TCP Fast Open，编辑目录<code class="language-plaintext highlighter-rouge">/etc/rc.local</code>下的文件。并在该文件的末尾加上下面这行内容，保存。</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo </span>3 <span class="o">&gt;</span> /proc/sys/net/ipv4/tcp_fastopen
</code></pre></div></div> <p>完成之后再去修改<code class="language-plaintext highlighter-rouge">/etc/sysctl.conf</code>文件，并在文末加上下面的内容，保存。</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>net.ipv4.tcp_fastopen <span class="o">=</span> 3
</code></pre></div></div> <p>然后再去修改对应的shadowsocks的对应配置文件<code class="language-plaintext highlighter-rouge">/etc/shadowsocks.json</code>。</p> <p>把其中”fast_open”一项的false改成true。</p> <h3 id="部署锐速">部署锐速</h3> <p>完成上述步骤后，使用过程中可能会发现连接速度有时不太稳定。这就是「锐速」发挥功能的时候了。锐速 ServerSpeeder 是一个 TCP 加速软件，对 Shadowsocks 客户端和服务器端间的传输速度有显著提升。</p> <p>而且，不同于 FinalSpeed 或 Kcptun 等需要客户端的工具，「锐速」的一大优势是只需要在服务器端单边部署就行了。换句话说，你不需要再安装另外一个应用。另外，「锐速」虽然已经停止注册和安装了，不过网上还是有不少「破解版」可用。</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget <span class="nt">-N</span> <span class="nt">--no-check-certificate</span> https://raw.githubusercontent.com/91yun/serverspeeder/master/serverspeeder-all.sh <span class="o">&amp;&amp;</span> bash serverspeeder-all.sh
</code></pre></div></div> <p>安装需要一段时间，等待一会。如果出现下图内容，请按提示输入数字。另外，若运行中碰到提示说需要更换内核的话，请参考<a href="https://www.91yun.co/archives/795" rel="external nofollow noopener" target="_blank">此文</a>更换之。</p> <p>安装完成之后，修改配置文件<code class="language-plaintext highlighter-rouge">/serverspeeder/etc/config</code>，将advinacc的0改成1，保存退出。</p> <h2 id="更多">更多</h2> <p>更多配置文件可以参考： <a href="https://github.com/shadowsocksr-backup/shadowsocks-rss/wiki/Server-Setup" rel="external nofollow noopener" target="_blank">https://github.com/shadowsocksr-backup/shadowsocks-rss/wiki/Server-Setup</a> <a href="https://github.com/shadowsocksr-backup/shadowsocks-rss/blob/master/ssr.md" rel="external nofollow noopener" target="_blank">https://github.com/shadowsocksr-backup/shadowsocks-rss/blob/master/ssr.md</a> <a href="https://github.com/shadowsocksr-backup/shadowsocks-rss/wiki/config.json" rel="external nofollow noopener" target="_blank">https://github.com/shadowsocksr-backup/shadowsocks-rss/wiki/config.json</a></p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/Word-Tricks/">Word 排版技巧</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2018/Black-First-Won/">Black First Won</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2017/%E9%92%B1%E7%A9%86%E5%85%88%E7%94%9F/">钱穆先生</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2015/images/">a post with images</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/Alias-Method/">Alias Method</a> </li> <div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"lccurious/lccurious.github.io","data-repo-id":"","data-category":"Comments","data-category-id":"","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Zenan Huang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?da39b660470d1ba6e6b8bf5f37070b6e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>