<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> iDAG | Curiousity Hub </title> <meta name="author" content="Zenan Huang"> <meta name="description" content="Invariant DAG Searching for Domain Generalization"> <meta name="keywords" content="causal-learning, causal-discovery, transfer-learning, LLMs, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon-32x32-next-my.png?b29ea1d332f6bc3c021e15d78d266303"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://lccurious.github.io/projects/003_idag/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "iDAG",
            "description": "Invariant DAG Searching for Domain Generalization",
            "published": "January 01, 2023",
            "authors": [
              
              {
                "author": "Zenan Huang",
                "authorURL": "https://lccurious.github.io/about",
                "affiliations": [
                  {
                    "name": "Zhejiang University",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Haobo Wang",
                "authorURL": "https://hbzju.github.io/",
                "affiliations": [
                  {
                    "name": "Zhejiang University",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Junbo Zhao",
                "authorURL": "http://jakezhao.net/",
                "affiliations": [
                  {
                    "name": "Zhejiang University",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Nenggan Zheng",
                "authorURL": "https://person.zju.edu.cn/en/nengganzheng",
                "affiliations": [
                  {
                    "name": "Zhejiang University",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Curiousity Hub </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/cv/">cv</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>iDAG</h1> <p>Invariant DAG Searching for Domain Generalization</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#abstract">Abstract</a> </div> <div> <a href="#motivation">Motivation</a> </div> <ul> <li> <a href="#data-generating-process">Data-generating process</a> </li> <li> <a href="#stable-dag-for-domains">Stable DAG for Domains</a> </li> </ul> <div> <a href="#idag">iDAG</a> </div> <ul> <li> <a href="#dag">DAG</a> </li> <li> <a href="#stable-feature-mask">Stable Feature Mask</a> </li> </ul> </nav> </d-contents> <h2 id="abstract">Abstract</h2> <p>Existing machine learning (ML) models are often fragile in open environments because the data distribution frequently shifts. To address this problem, domain generalization (DG) aims to explore underlying invariant patterns for stable prediction across domains. In this work, we first characterize that this failure of conventional ML models in DG attributes to an inadequate identification of causal structures. We further propose a novel invariant Directed Acyclic Graph (dubbed iDAG) searching framework that attains an invariant graphical relation as the proxy to the causality structure from the intrinsic data-generating process. To enable tractable computation, iDAG solves a constrained optimization objective built on a set of representative class-conditional prototypes. Additionally, we integrate a hierarchical contrastive learning module, which poses a strong effect of clustering, for enhanced prototypes as well as stabler prediction. Extensive experiments on the synthetic and real-world benchmarks demonstrate that iDAG outperforms the state-of-the-art approaches, verifying the superiority of causal structure identification for DG.</p> <h2 id="motivation">Motivation</h2> <div class="row"> <div class="col-sm-8 mt-3 mt-md-0 mx-auto"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/003_idag/motivation-480.webp 480w,/assets/img/003_idag/motivation-800.webp 800w,/assets/img/003_idag/motivation-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/003_idag/motivation.png" class="img-fluid" width="100%" height="auto" title="Causal structure of visual data" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Multiple causally related factors may be present in visual data, and these factors are structurally organized together and present a higher level of semantics. However, due to domain diversity, the learned color factors in one domain can be useless in others; the spurious factors that dominate classification in one domain can be misleading in others. iDAG seeks to estimate the DAG which represents the directed causal relations between factors. </div> <h3 id="data-generating-process">Data-generating process</h3> <p><strong>Domain Generalization</strong>. The goal of domain/out-ofdistribution generalization is to explore the invariant pattern from multi-domain data to mitigate potential domain shifts when testing.</p> <p>There is a group of injective data-generating functions \(g^{e}_{y}(\cdot), g^{e}_{s}(\cdot), g^{e}_{r}(\cdot)\), or each environment, the underlying factors of observational data follow the rule:</p> \[\begin{equation} y^{e}=g_{y}(\boldsymbol{z}^{e}_{y})+\epsilon_{y},\quad \boldsymbol{z}^{e}_{s}=g_{s}(y^{e})+\boldsymbol{\epsilon}^{e}_{s},\quad \boldsymbol{z}^{e}_{r}=\boldsymbol{\epsilon}^{e}_{r}, \end{equation}\] <p>where \(\boldsymbol{z}^{e}_{y}\) denotes invariant features, \(\boldsymbol{z}^{e}_{s}\) denotes the easier-to-fit spurious features, \(\boldsymbol{z}^{e}_{r}\) denotes the domain-private features, \(\boldsymbol{\epsilon}^{e}_{y}\), \(\boldsymbol{\epsilon}^{e}_{s}\), \(\epsilon^{e}_{r}\) are mutually independent exogenous noises.</p> <h3 id="stable-dag-for-domains">Stable DAG for Domains</h3> <p>For the sake of notational simplicity, we will use \(v_{i}\) to uniformly represent feature element \(z_{i}\) and label \(y\). Thereafter, we can define a structural causal model (SCM) on the whole collection of causal factors \(\mathcal{V}=\{v_{i}\}^{d}_{i=1}=\{z_{i}\}^{d}_{i=1}\cup \{y\}\).</p> <blockquote> <p><strong>Definition 1.</strong> (Domain Invariant DAG). A domain-specific SCM \(\mathcal{M}^{e}\) on a set of nodes \(\boldsymbol{V}^{e}\) with joint distribution \(p(\boldsymbol{v}^{e})\), according to Markov condition, it can be factorized by:</p> \[\begin{equation} p_{\mathcal{M}^{e}}=\prod_{i}p_{\mathcal{M}^{e}}(v^{e}_{i} | \textbf{Pa}^{e}_{i}) \end{equation}\] </blockquote> <p>Once the causal graph is reconstructed, the relations/factors of the task is determinined. (Please see the paper for details.)</p> <h2 id="idag">iDAG</h2> <div class="l-body-outset"> <div class="col-sm mt-3 mt-md-0 mx-auto"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/003_idag/02-framework-480.webp 480w,/assets/img/003_idag/02-framework-800.webp 800w,/assets/img/003_idag/02-framework-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/003_idag/02-framework.png" class="img-fluid" width="100%" height="auto" title="iDAG" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The features are used to update the domain-specific prototypes. The prototypes concatenated with labels are then used to optimize a Directed Acyclic Graph. The shaded green regime on DAG indicates the factors have total effects on label y, and the invariant features corresponding to these factors are used for final prediction. </div> <h3 id="dag">DAG</h3> <p>Let \(\boldsymbol{V} \in \mathbb{R}^{d\times n}\) be the values matrix of a set of vertices \(\mathcal{V}\), and \(\boldsymbol{v} \sim \mathcal{N}(0, \boldsymbol{\Sigma})\) (without the loss of generality, we assume the values are preprocessed by a simple bias term with zero means). The linear DAG model is given by:</p> \[\begin{equation} \boldsymbol{V} = \boldsymbol{A}^{e} \boldsymbol{V} + \boldsymbol{N} \end{equation}\] <p>Therefore, we can find the causal graph by exploring the joint distribution of \(\boldsymbol{V}\):</p> \[\begin{equation} \mathcal{L}_{\rm rec}(\boldsymbol{A}^{e};\boldsymbol{\Sigma})=\frac{1}{2}\mathrm{Tr} \left((\boldsymbol{I} - \boldsymbol{A}^{e})^{\top}\boldsymbol{\Sigma}(\boldsymbol{I} - \boldsymbol{A}^{e})\right). \end{equation}\] <p>The optimization problem is:</p> \[\begin{equation} \min_{\boldsymbol{A}^{e}} \mathcal{L}_{\rm rec}(\boldsymbol{A}^{e};\boldsymbol{\Sigma}) \quad \text{s.t.} \quad h(\boldsymbol{A}^{e})= e^{\boldsymbol{A}^{e}\odot \boldsymbol{A}^{e}} = 0 ~ (\boldsymbol{A}^{e} \in \mathrm{DAG}) \end{equation}\] <h3 id="stable-feature-mask">Stable Feature Mask</h3> <p>To obtain a more stable prediction, it is required to collect not only the parent factors but also the ancestral factors of \(y\) in the DAG. Thus, we define invariant features by including all direct and indirect causal factors. Follow the idea of the fact that the positivity of the \((i,j)\) element of the \(k\)-th power of \(\boldsymbol{A}\) indicates the existence of a length-\(k\) path \(v_{i}\to \cdots \to v_{j}\), we derive the \(\boldsymbol{P}^{\text{tol}}\) to analogy the directed pairwise total effects,</p> \[\begin{equation} \boldsymbol{P}^{\text{tol}}=\left[\sum^{\infty}_{k=0}\frac{1}{k!}(\boldsymbol{A}\odot \boldsymbol{A})^{k} \right]=e^{\boldsymbol{A}\odot \boldsymbol{A}} \end{equation}\] <p>Then, the invariant features \(\boldsymbol{z}^{e}_{y}:=\boldsymbol{z}^{e}\odot [\boldsymbol{P}^{\text{tol}}]^{\top}_{d+1,1:d}\in\mathbb{R}^{d}\) contains all the direct and indirect causal features of \(y\).</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/003_idag.bib"></d-bibliography> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Zenan Huang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>